<!DOCTYPE html>
<html>

<head>
<meta charset="utf-8" http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Everit Component Model</title>
<link rel="icon" type="image/ico" href="../fonts/favicon.ico">
<!-- Bootstrap core CSS -->
<link href="../css/bootstrap.min.css" rel="stylesheet">

<!-- Documentation extras -->
<link href="../css/docs.min.css" rel="stylesheet">
<link href="../css/everit.css" rel="stylesheet">

<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
    <script src="../js/html5shiv.min.js"></script>
    <script src="../js/respond.min.js"></script>
    <script src="../js/respond.matchmedia.addListener.min.js"></script>
    <![endif]-->

<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push([ '_setAccount', 'UA-15041869-4' ]);
  _gaq.push([ '_setDomainName', 'everit.org' ]);
  _gaq.push([ '_trackPageview' ]);
</script>
<style type="text/css">
.ecm-chapter {
    text-align: justify;
}
</style>
</head>

<body class="bs-docs-home" data-spy="scroll" data-target="#affix-nav">
  <a class="sr-only" href="#content">Skip to main content</a>

  <!-- Docs master nav -->
  <header class="navbar navbar-static-top bs-docs-nav" id="top" role="banner">
    <div class="container">
      <div class="navbar-header">
        <button class="navbar-toggle" type="button" data-toggle="collapse"
          data-target=".bs-navbar-collapse">
          <span class="sr-only">Toggle navigation</span> <span class="icon-bar"></span> <span
            class="icon-bar"></span> <span class="icon-bar"></span>
        </button>
        <a href="index.html" class="navbar-brand ">Everit</a>
      </div>
      <nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
        <ul class="nav navbar-nav ">
          <li><a href="components.html ">Components</a></li>
          <li><a href="documentation.html">Documentation</a></li>
          <li><a href="oldsite.html ">Old site</a></li>
        </ul>
        <ul class="nav navbar-nav navbar-right ">
          <li><a href="http://www.everit.biz " target="_blank">Enterprise</a></li>
          <li><a href="http://everitorg.wordpress.com/ " target="_blank">Blog</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <div class="bs-docs-masthead everit-header" id="content" role="main">
    <div class="container ">
      <span class="bs-docs-booticon bs-docs-booticon-lg bs-docs-booticon-outline "> <img
        class="logo " src="../fonts/sbz_e.svg" alt="E">
      </span>
      <p class="lead ">Everit Component Model</p>
    </div>
  </div>
  <div class="container">
    <div class="col-md-10">
      <div class="bs-docs-featurette ecm-chapter" id="introduction">
        <h2 class="bs-docs-featurette-title ">Introduction</h2>
        <p>
          ECM is a <a href="http://wiki.osgi.org/wiki/Component_Models_Overview">component model</a>
          designed to work well in large OSGi based applications. Developers who have used <a
            href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative Services</a> before
          will find the concept of ECM familiar.
        </p>
        <p>
          While modularization gives <a href="http://www.osgi.org/Technology/WhyOSGi">lots of
            benefits</a> to a project, developers often feel that the application skeleton is similar to
          a house of cards. If any of the component has an issue, part of the system collapses, and
          it is nearly impossible to find the origin of the problem. One of the goals of Everit
          Component Model is to help developers finding the cause of issues in OSGi.
        </p>
        <p>
          Instead of <a href="http://wiki.osgi.org/wiki/Whiteboard_Pattern">whiteboard pattern</a>,
          ECM supports the top-down configuration approach. While developers can wire components
          together with whiteboard pattern rapidly, they lose the ability of systematic issue
          detection. E.g.: When part of an application is not started, and no exception is thrown,
          it is hard to find the missing piece. Searching the issue is even harder when one has to
          fix an issue in an application that was written by other.
        </p>
        <p>With top-down configuration design, developers can start searching the problem from
          the top of the application skeleton and by walking down on the unsatisfied component
          graph, they can find the original cause of the issue rapidly. With ECM, designing OSGi
          based applications becomes easier and more fun.</p>
      </div>
      <div class="bs-docs-featurette ecm-chapter" id="quickstart">
        <h2 class="bs-docs-featurette-title ">Quick start</h2>
        <p>There are several ways to use the Everit Component Model. The easiest way is using
          OSGi extender pattern, while components can be created and started programmatically, too.</p>
        <h3 id="usage-extender">Using the Extender</h3>
        <p>During development time, add the following dependencies (with their dependencies
          transitively):</p>
        <ul>
          <li><p>
              <a href="#ecm-annotation">ecm-annotation</a>
            </p></li>
          <li><p>
              <a href="#ecm-extender-api">ecm-extender-api</a>
            </p></li>
          <li><p>
              <a href="http://search.maven.org/#search%7Cga%7C1%7Ca%3A%22biz.aQute.bndlib%22">bndlib</a>
              with <i>provided</i> scope as it is only necessary for annotation processing
            </p></li>
        </ul>

        <p>In order to be picked up by the extender, the component class must be annotated in
          the following way:</p>
        <pre class="prettyprint lang-java">import org.everit.osgi.ecm.annotation.Component;
import aQute.bnd.annotation.headers.ProvideCapability;

@Component
@ProvideCapability(ns = ECMExtenderConstants.CAPABILITY_NS_COMPONENT,
    value = ECMExtenderConstants.CAPABILITY_ATTR_CLASS + "" + "=${@class}")
public class MyComponent {
}</pre>
        <p>
          The documentation of <a href="#ecm-annotation">ecm-annotation</a> OSGi bundle contains the
          full list of annotations that can be used during the creation of a component class.
        </p>
        <p>
          With a build tool that uses <i>bndlib</i> inside, the necessary MANIFEST header will be
          automatically generated. Such tools are bndtools and maven-bundle-plugin. If this
          automation is not available, the <i>Provide-Capability</i> header must be manually
          defined:
        </p>
        <pre class="prettyprint">Provide-Capability: org.everit.osgi.ecm.component;class="mypackage.MyComponent"</pre>
        <p>By having the necessary MANIFEST header, the ECM Extender will automatically pick up
          the specified class and look for annotations in it.</p>
        <p>In the runtime environment, the following OSGi bundle should be installed with its
          dependencies:</p>
        <ul>
          <li><p>
              <a href="#ecm-extender-ri">extender-ri</a>
            </p></li>
        </ul>
        <h3 id="usage-programmatic">Programmatic way</h3>
        <p>Everit Component Model is designed in the way that Components can be created
          programmatically, too. During the development and also on the running OSGi container, the
          following OSGi bundle with its dependencies should be used:</p>
        <ul>
          <li><p>
              <a href="#ecm-component-ri">ecm-component-ri</a>
            </p></li>
        </ul>
        <p>
          In the following example, a very simple <a href="ecm-component-container">ECM
            Component Container</a> is created and started within a Bundle-Activator:
        </p>
        <pre class="prettyprint lang-java">
import org.everit.osgi.ecm.component.ri.ComponentContainerFactory;
import org.everit.osgi.ecm.component.ri.ComponentContainerInstance;
import org.everit.osgi.ecm.metadata.ComponentMetadata;
import org.everit.osgi.ecm.metadata.ComponentMetadata.ComponentMetadataBuilder;
import org.osgi.framework.BundleActivator;
import org.osgi.framework.BundleContext;

public class MyActivator {

  private ComponentContainerInstance&lt;MyComponent&gt; myComponentContainer

  @Override
  public void start(final BundleContext context) {
    ComponentMetadataBuilder builder = new ComponentMetadataBuilder();
    ComponentMetadata metadata = builder.withType(MyComponent.class).build();

    ComponentContainerFactory factory = new ComponentContainerFactory(context);

    this.myComponentContainer = factory.createComponentContainer(metadata);
    this.myComponentContainer.open();
  }

  @Override
  public void stop(final BundleContext context) {
    this.myComponentContainer.close();
  }
}</pre>
        <p>
          For more information, how to build <i>ComponentMetadata</i> programmatically, see the
          documentation of <a href="#ecm-metadata">ecm-metadata</a> OSGi bundle!
        </p>
      </div>
      <div class="bs-docs-featurette ecm-chapter" id="specification">
        <h2 class="bs-docs-featurette-title ">Specification</h2>
        <h3 id="component-metadata">Component metadata</h3>
        <p>
          A component is described by its metadata. The metadata is passed to the <a
            href="#component-container">component container</a> during its instantiation. The <i>metadata</i>
          contains all information about configurability, the attributes and the requirements of the
          component.
        </p>
        <h3 id="component-container">Component container</h3>
        <p>
          A <i>Component Container</i> is responsible for the instantiation and lifecycle of <a
            href="component-context">Component Contexts</a>. When the <i>Component Container</i> is
          opened, an OSGi service is registered with the following interfaces:
        </p>
        <div class="responsive-table">
          <div class="row hidden-xs">
            <div class="col-sm-3 col-lg-6">
              <b>Interface</b>
            </div>
            <div class="col-sm-9 col-lg-6">
              <b>Description</b>
            </div>
          </div>
          <hr class="double-hr hidden-xs" />
          <div class="empty-separator visible-xs">&nbsp;</div>
          <div class="row">
            <div class="col-sm-3 col-lg-6">
              <span class="hidden-xs hidden-sm hidden-md">org.everit.osgi.ecm.component.resource.</span>ComponentContainer
            </div>
            <div class="col-sm-9 col-lg-6">
              Used to retrieve all information about the state of the container instance.
              Programmers can list the instantiated components, get the <i>metadata</i> that belongs
              to the component, etc.
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col-sm-3 col-lg-6">
              <a href="https://osgi.org/javadoc/r4v42/org/osgi/service/cm/ManagedService.html"><span
                class="hidden-xs hidden-sm hidden-md">org.osgi.service.cm.</span>ManagedService</a>
            </div>
            <div class="col-sm-9 col-lg-6">
              Only if the <a href="#TBD">configuration policy</a> of the container is either <a
                href="#policy-optional">OPTIONAL</a> or <a href="#policy-required">REQUIRED</a>
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col-sm-3 col-lg-6">
              <a
                href="https://osgi.org/javadoc/r4v42/org/osgi/service/cm/ManagedServiceFactory.html"><span
                class="hidden-xs hidden-sm hidden-md">org.osgi.service.cm.</span>ManagedServiceFactory</a>
            </div>
            <div class="col-sm-9 col-lg-6">
              Only if the <a href="#TBD">configuration policy</a> of the container is <a
                href="#policy-factory">FACTORY</a>.
            </div>
          </div>
          <hr />
          <div class="row">
            <div class="col-sm-3 col-lg-6">
              <a
                href="https://osgi.org/javadoc/r4v42/org/osgi/service/metatype/MetaTypeProvider.html"><span
                class="hidden-xs hidden-sm hidden-md">org.osgi.service.metatype.</span>MetaTypeProvider</a>
            </div>
            <div class="col-sm-9 col-lg-6">
              Only if the <i>metatype</i> data belongs to the container.
            </div>
          </div>
        </div>
        <p>
          ECM relies on the <i>Configuration Admin</i> chapter of <i>OSGi Compendium
            specification</i>. If any configuration is necessary, <i>ComponentContainer</i> OSGi service
          is registered with <i>ManagedService</i> or <i>ManagedServiceFactory</i> interface. <i>Configuration
            Admin</i> notifies the <i>Component Container</i> by calling the OSGi service if a new
          configuration is available, a configuration was modified or a configuration was deleted.
          The behavior of the Component Container depends on the configuration policy:
        </p>
        <ul>
          <li><p>
              <strong id="policy-ignore">IGNORE</strong>: Neither ManagedService nor
              ManagedServieFactory interface is used when the ComponentContainer OSGi service is
              registered. The container instantiates and opens the <a href="#component-context">Component
                Context</a> as soon as the container is opened and all references of the component are
              satisfied.
            </p></li>
          <li><p>
              <strong id="policy-optional">OPTIONAL</strong>: One <a href="#component-context">Component
                Context</a> will be instantiated and opened as soon as the <i>Container</i> is started.
              In case a configuration is available, the Component Context will be upgraded. <strong><span
                class="text-danger">Although this is the default policy for components, we do
                  not recommend using it. Strange behavior can happen. E.g.: A component is created
                  while starting the framework than it is re-activated (and all dependent components
                  are re-activated recursively) when Configuration Admin starts.</span></strong>
            </p></li>
          <li><p>
              <strong id="policy-required">REQUIRED</strong>: The <a href="#component-context">Component
                Context</a> will be instantiated and opened only if a configuration is available. If the
              configuration is not available anymore, the <i>Container</i> closes the <a
                href="#component-context">Component Context</a>.
            </p></li>
          <li><p>
              <strong id="policy-factory">FACTORY</strong>: The <i>Container</i> will instantiate
              and open as many <a href="#component-context">Component Contexts</a> as many
              configuration is available.
            </p></li>
        </ul>
        <div class="clearfix">
          <div class="col-xs-10 col-xs-offset-1 col-md-5 col-md-offset-0 text-center"
            style="padding-bottom: 1em;">
            <img alt="Container-Context relation with Factory configuration policy"
              style="max-width: 100%;" src="container-context-factory.svg">
          </div>
          <div class="col-xs-10 col-xs-offset-1 col-md-5 col-md-offset-1 text-center"
            style="padding-bottom: 1em;">
            <img
              alt="Container-Context relation with Ignore, Optional or Required configuration policy"
              style="max-width: 100%;" src="container-context-simple.svg">
          </div>
        </div>
        <h3 id="component-context">Component context</h3>

        <p>
          <i>Component contexts</i> are instantiated and started by the <a
            href="#component-container">Component containers</a>. One <i>Component context</i>
          handles the lifecycle of exactly one <i>Component</i>.
        </p>
        <p>
          The <a href="#">ComponentContext</a> instance can be used within a component to
        </p>
        <ul>
          <li>get the current configuration of the component</li>
          <li>access the <i>metadata</i> of the component via the <i>component container</i>
          <li>access the <a
            href="https://osgi.org/javadoc/r4v43/core/org/osgi/framework/BundleContext.html">BundleContext</a>
            of the bundle that registered the <i>component container</i>
          <li>register OSGi services</li>
        </ul>
        <p>
          <strong class="text-danger">OSGi services should be always registered with <i>ComponentContext</i>
            and not via <i>BundleContext</i> directly!
          </strong> ECM can provide complete <a href="#">Component wiring</a> information only if OSGi
          services are registered via <i>ComponentContext</i>.
        </p>
        <p>
          Component developers can receive the <i>component context</i> by specifying it as a
          parameter of the <a href="">activate</a> method of the component.
        </p>


        <h3 id="component-lifecycle">Component lifecycle</h3>
        <h4 id="component-states">Component states</h4>
        <p>
          The <a href="#component-context">component context</a> manages the lifecycle of the
          component. A component might have one of the following states:
        </p>
        <div class="responsive-table">
          <div class="row hidden-xs">
            <div class="col-sm-5 col-md-4 col-lg-3">
              <b>State</b>
            </div>
            <div class="col-sm-7">
              <b>Description</b>
            </div>
          </div>
          <hr class="double-hr hidden-xs" />
          <div class="empty-separator visible-xs">&nbsp;</div>
          <div id="state-inactive" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">INACTIVE</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              The <a href="#component-context">component context</a> that manages this component is
              closed.
            </div>
          </div>
          <hr />
          <div id="state-unsatisfied" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">UNSATISFIED</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              The component has one or more unsatisfied <a href="requirements">requirements</a>.
            </div>
          </div>
          <hr />
          <div id="state-starting" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">STARTING</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              <p>
                The <a href="#component-context">component context</a> is starting the component.
                The starting process contains the following steps:
              </p>
              <ol>
                <li>The <a href="#component-context">component context</a> instantiates the <i>component</i>
                  class.
                </li>
                <li>The <a href="#component-context">component context</a> calls the setters of
                  the <i>component instance</i>
                </li>
                <li>The <a href="#activate-method">Activate</a> method of the <i>component
                    instance</i> method is called
                </li>
                <li>The <i>Component context</i> registers the <i>component instance</i> as an
                  OSGi service if automatic service registration is defined.
                </li>
              </ol>
            </div>
          </div>
          <hr />
          <div id="state-active" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">ACTIVE</div>
            <div class="col-sm-7 col-md-8 col-lg-9">The component is active and if defined so,
              it is registered as an OSGi service.</div>
          </div>
          <hr />
          <div id="state-updating-configuration" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">UPDATING_CONFIGURATION</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              The <a href="#component-container">component container</a> is currently updating
              non-dynamic attributes on the <a href="#component-context">component context</a>.
            </div>
          </div>
          <hr />
          <div id="state-stopping" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">STOPPING</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              <p>
                The <a href="#component-context">component context</a> started the stopping process
                on the component instance but has not finished yet. The stopping process runs the
                following steps:
              </p>
              <ol>
                <li>The <a href="#component-context">component context</a> unregisters the OSGi
                  service that was automatically registered based on the component instance (if
                  automatic service registration was defined).
                </li>
                <li>The <a href="#component-context">component context</a> calls the <a
                  href="#deactivate-method">deactivate method</a> on the <i>component instance</i>
                  if one defined.
                </li>
                <li>The <a href="#component-context">component context</a> checks whether all
                  OSGi services were unregistered by the <a href="#deactivate-method">deactivate
                    method</a> that were registered with the functions of the <a
                  href="#component-context">component context</a>. If not, the <a
                  href="#component-context">component context</a> unregisters them and writes a <i>WARN</i>
                  message into the log.
                </li>
              </ol>
            </div>
          </div>
          <hr />
          <div id="state-failed" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">FAILED</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              An exception was thrown by
              <ul>
                <li>the <a href="#component-context">component context</a> during validating
                  the configuration of the component.
                </li>
                <li>any of the <a href="#setter-method">setter methods</a> of the <i>component
                    instance</i>.
                </li>
                <li>the <a href="#activate-method">activate method</a> of the <i>component
                    instance.</i></li>
                <li>the <a href="#update-method">update method</a> of the <i>component
                    instance.</i></li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="state-failed-permanent" class="row">
            <div class="col-sm-5 col-md-4 col-lg-3">FAILED_PERMANENT</div>
            <div class="col-sm-7 col-md-8 col-lg-9">
              <p>
                The component will be permanently failed if <i>metadata</i> of the component is
                inconsistent. E.g.:
              </p>
              <ul>
                <li>The class of the component cannot be found or instantiated.</li>
                <li>Specified <i>Activate</i>, <i>Update</i> or <i>Deactivate</i> method does
                  not exist
                </li>
                <li>Any of the specified setters does not exist</li>
              </ul>
            </div>
          </div>
        </div>
        <div id="state-dynamic-update" class="row">
          <div class="col-sm-5 col-md-4 col-lg-3">Dynamic update</div>
          <div class="col-sm-7 col-md-8 col-lg-9">
            <p>
              <i>Dynamic update</i> happens when the <a href="#component-context">component
                context</a> updates the component instance without leaving the <a href="#state-active">ACTIVE</a>
              state. That means that <i>Dynamic update</i> is not a state that appears for the user.
              If the update is successful, the process runs without changing the state of the
              component. The <i>Dynamic update</i> process executes the following steps:
            </p>
            <ul>
              <li>Calls the setters of the attributes and references that has been changed</li>
              <li>Calls the <a href="#update-method">update method</a> of the component
                instance if one is implemented
              </li>
            </ul>
          </div>
        </div>
        <h4>State transitions</h4>
        <div class="text-center" style="padding-top: 1em;">
          <img alt="Component Lifecycle Diagram" src="lifecycle.svg" style="max-width: 100%;">
        </div>
        <div class="responsive-table">
          <div class="row hidden-xs">
            <div class="col-sm-5 col-lg-4">
              <b>State transition</b>
            </div>
            <div class="col-sm-7 col-lg-8">
              <b>Description</b>
            </div>
          </div>
          <hr class="double-hr hidden-xs" />
          <div class="empty-separator visible-xs">&nbsp;</div>
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>1:</strong> <a href="#state-inactive">INACTIVE</a> &rarr;&nbsp;<a
                  href="#state-starting">STARTING</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              If all of the <a href="#component-requirement">requirements of the component</a> are
              satisfied, the <a href="#state-starting">starting process</a> will start.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>2:</strong> <a href="#state-inactive">INACTIVE</a> &rarr;&nbsp;<a
                  href="#state-unsatisfied">UNSATISFIED</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              If any of the <a href="#component-reference">requirements</a> of the component is
              unsatisfied, the component becomes <a href="#state-unsatisfied">UNSATISFIED.</a>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>3:</strong> <a href="#state-unsatisfied">UNSATISFIED</a> &rarr;&nbsp;<a
                  href="#state-starting">STARTING</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              The component context calls the <a href="#state-starting">starting process</a> if all
              <a href="#component-requirement">requirements</a> becomes satisfied.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>4:</strong> <a href="#state-starting">STARTING</a> &rarr;&nbsp;<a
                  href="#state-failed">FAILED</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                The <a href="#state-starting">starting process</a> if
              </p>
              <ul>
                <li>The instantiation of the component class throws and exception.</li>
                <li>The type of the value of any of the attributes does not match with the
                  defined type of the attribute</li>
                <li>Any of the specified <a href="#setter-method">setter methods</a> of the
                  component instance throws an exception.
                </li>
                <li>The <a href="activate-method">activate method</a> throws an exception
                </li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>5:</strong> <a href="#state-failed">FAILED</a> &rarr;&nbsp;<a
                  href="#state-starting">STARTING</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                The <a href="#component-context">component context</a> tries to start a <a
                  href="state-failed">FAILED</a> component if
              </p>
              <ul>
                <li>the configuration is changed</li>
                <li>the wirings to the <a href="#component-requirement">requirements of the
                    component</a> are changed (e.g.: the OSGi service that would satisfy a service
                  reference is replaced by other one)
                </li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>6:</strong> <a href="#state-starting">STARTING</a> &rarr;&nbsp;<a
                  href="#state-active">ACTIVE</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              The component becomes <a href="#state-active">ACTIVE</a> if the <a
                href="#state-starting">starting process</a> finishes successfully.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>7:</strong> <a href="#state-active">ACTIVE</a>
                &rarr;&nbsp;Dynamic&nbsp;update
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                The <a href="#component-context">component context</a> <a
                  href="#state-dynamic-update">updates the component dynamically</a> if
              </p>
              <ul>
                <li>the configuration that belongs to the component instance is updated and
                  only dynamic attributes are changed</li>
                <li>the configuration that belongs to the component instance is updated and
                  only the configuration of dynamic requirements are changed in the way that all of
                  the requirements is satisfied with the new configuration (e.g.: an OSGi service is
                  unregistered but there is another one that satisfies the component)</li>
                <li>if a capability that is wired to one of the dynamic requirement of the
                  component is replaced by another capability</li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>8:</strong> Dynamic&nbsp;update &rarr;&nbsp;<a href="#state-active">ACTIVE</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              If the <a href="#state-dynamic-update">dynamic update process</a> is successful, the
              component state remains <a href="#state-active">ACTIVE</a>.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>9:</strong> Dynamic&nbsp;update &rarr;&nbsp;<a href="#state-stopping">STOPPING</a>
                &rarr;&nbsp;<a href="#state-failed">FAILED</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              If any of the <a href="#setter-method">setter methods</a> or the <a
                href="#update-method">update method</a> of the component instance throws an
              exception, the <a href="#component-context">component context</a> <a
                href="#state-stopping">stops</a> the component instance and the component will get
              the <a href="#state-failed">FAILED</a> state.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>10:</strong> <a href="#state-active">ACTIVE</a> &rarr;&nbsp;<a
                  href="#state-stopping">STOPPING</a> &rarr;&nbsp;<a
                  href="#state-updating-configuration">UPDATING_CONFIGURATION</a> &rarr;&nbsp;<a
                  href="#state-starting">STARTING</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">When non-dynamic attributes or non-dynamic
              references are changed, the component is restarted with the new configuration.</div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>11:</strong> <a href="#state-active">ACTIVE</a> &rarr;&nbsp;<a
                  href="#state-stopping">STOPPING</a> &rarr;&nbsp;<a href="#state-unsatisfied">UNSATISFIED</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              When one of the <a href="#component-requirement">requirements</a> of an <a
                href="#state-active">ACTIVE</a> component becomes unsatisfied, the component is <a
                href="#state-stopping">stopped</a> and becomes <a href="#state-unsatisfied">UNSATISFIED</a>.
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>12:</strong> <a href="#state-active">ACTIVE</a> &rarr;&nbsp;<a
                  href="#state-stopping">STOPPING</a> &rarr;&nbsp;<a href="#state-inactive">INACTIVE</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                When the <a href="#component-context">component context</a> is closed and the
                component is <a href="#state-active">ACTIVE</a>, the <a href="#component-context">component
                  context</a>
              </p>
              <ul>
                <li><a href="#state-stopping">stops</a> the component,</li>
                <li>and sets the state of itself to <a href="#state-inactive">INACTIVE</a></li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>13:</strong> <a href="#state-failed">FAILED</a> &rarr;&nbsp;<a
                  href="#state-inactive">INACTIVE</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                When the <a href="#component-context">component context</a> is closed and the
                component is <a href="#state-failed">FAILED</a>, the <a href="#component-context">component
                  context</a>
              </p>
              <ul>
                <li>sets the state of itself to <a href="#state-inactive">INACTIVE</a></li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-inactive-starting" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>14:</strong> <a href="#state-unsatisfied">UNSATISFIED</a> &rarr;&nbsp;<a
                  href="#state-inactive">INACTIVE</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                When the <a href="#component-context">component context</a> is closed and the
                component is <a href="#state-unsatisfied">UNSATISFIED</a>, the <a
                  href="#component-context">component context</a>
              </p>
              <ul>
                <li>sets the state of itself to <a href="#state-inactive">INACTIVE</a></li>
              </ul>
            </div>
          </div>
          <hr />
          <div id="transition-starting-failed_permanent" class="row">
            <div class="col-sm-5 col-lg-4">
              <div class="state-transition-label">
                <strong>15:</strong> <a href="#state-starting">STARTING</a> &rarr;&nbsp;<a
                  href="#state-failed-permanent">FAILED_PERMANENT</a>
              </div>
            </div>
            <div class="col-sm-7 col-lg-8">
              <p>
                If the there is an exception that can be expected every time the component would <a
                  href="#state-starting">start</a>, the <a href="#component-context">component
                  context</a> sets the <a href="#state-failed-permanent">FAILED PERMANENT</a> state.
                After having this state, the <a href="#component-context">component context</a> will
                ignore any configuration or <a href="#component-requirement">requirement</a> change.
                Such exception can be an <i>IllegalAccessException</i> during the component
                instantiation.
              </p>
            </div>
          </div>

          <h3 id="component-attributes">Component attributes</h3>
          <h4>Attribute types</h4>
          <p>
            An attribute always has one of the following types: <i>boolean, byte, char, double,
              float, int, long, password, short, String</i>.
          </p>
          <h4>Attribute cardinality</h4>
          <p>
            An attribute might be optional or required. In case of optional, the attribute value
            might be <i>undefined</i>. In case the attribute is not defined, its <i>setter</i> will
            not be called.
          </p>
          <p>
            An attribute has a "<i>multiple</i>" flag. If the "<i>multiple</i>" flag is <i>true</i>,
            the attribute can have more than one values. If a <i>setter</i> method is defined for a
            <i>multiple=true</i> attribute, the parameter of the setter must be the array of the
            attribute type. E.g.: int[], String[], ...
          </p>
          <h4>Dynamic attribute</h4>
          <p>Every time the value of the attribute changes (most likely via Configuration Admin)
            the following will happen:</p>
          <ul>
            <li>if the attribute is <i>non-dynamic</i>, the component will be restarted.
            </li>
            <li>if the attribute is <i>dynamic</i>, the <i>setter</i> method of the component
              (if there is any) will be called and the if the <a href="update-method">update
                method</a> is defined, it will be called as well.
          </ul>

          <h3 id="component-references">Component references</h3>
          <div class="text-center">
            <img alt="Component, Reference, Requirement, Capability relationship"
              src="component-references.svg" class="block-image" />
          </div>
          <p>
            Components can have zero or more references. References can have zero or more
            requirements, based on the <a href="#reference-cardinality">cardinality of the
              reference</a>.
          </p>
          <p>
            The <a href="#component-context">component context</a> <a href="#state-starting">starts</a>
            the component only if all references of the component are satisfied. A reference is
            satisfied if all requirements of the reference are wired to 1-1 matching capability.
          </p>
          <p>Every requirement is specified with the following properties:</p>
          <ul>
            <li><strong>Requirement Id:</strong> The id of the requirement.</li>
            <li><strong>Attributes:</strong> Key-value pairs that can be used by the programmer
              of the component.</li>
            <li><strong>Directives:</strong> At the moment, only <i>filter</i> directive is
              supported. The requirement becomes satisfied, if there is a capability with a specific
              attribute set that matches with OSGi filter expression defined by the filter
              directive.</li>
          </ul>
          <p>
            While <a href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative Services</a>
            supports only one kind of reference, <i>Everit Component Model</i> supports two type of
            requirements: <a href="#requirement-service-reference">OSGi service requirements</a> and
            <a href="#requirement-bundle-capability">Bundle-Capability requirements</a>.
          </p>
          <h4>Configuration modes</h4>
          <h5 id="requirement-config-filter">Filter expression</h5>
          <p>
            Like in <a href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative
              Services</a>, the references of <i>ECM components</i> can also be configured with OSGi
            service filters. E.g.:
          </p>
          <pre>myReference.target = (service.pid=MyDataSource_XXXX-XXXX-XXXX-XXX)</pre>
          <p>If no filter is defined, every capability with the same namespace will match the
            requiement. The filter expression can filter based on the attributes of the capability.</p>
          <p>
            In case the reference configuration is <i>OSGi filter</i> based, each requirement will
            be created with the following definition:
          </p>
          <ul>
            <li><strong>Requirement Id:</strong> An incremented number starting with 0. If the
              <a href="#reference-cardinality">cardinality</a> of the reference allows the
              definition of <i>multiple</i> requirements, the requirement ids in the array of
              requirements will be 0, 1, ...</li>
            <li><strong>Attributes:</strong> The requirements will have no attribute</li>
            <li><strong>Directives:</strong> The requirements will have one <i>filter</i>
              directive if an expression is defined.</li>
          </ul>
          <h5 id="requirement-config-clause">Clause</h5>
          <i>Everit Component Model</i> also supports a more complex configuration mode for
          references. During the development of a component, programmers can specify that a
          reference should be configured with a clause. In general, a clause looks like this:
          <pre>myReference.clause = requirementId;attr1=val1;attr2=val2;filter:=(key=value)</pre>
          A clause is built up from the following parts:
          <ul>
            <li><strong>Requirement Id:</strong> The clause starts with the id of the
              requirement. Requirement id must be unique within the scope of the reference.</li>
            <li><strong>Attributes:</strong> The clause can contain yero or more attributes
              separated by semicolon. The attribute is built up from a key-value pair where the key
              is separated with an equality (=) character from the value.</li>
            <li><strong>Filter directive:</strong> A filter can be optionally defined. If no
              filter is defined, every capability with the same namespace will match the requiement.
              The filter expression can filter based on the attributes of the capability. Directives
              use (:=) as key-value separator.</li>
          </ul>
          <pre>
servlets.clause = [ "app;url-pattern=/myApp/*;filter:=(service.pid=MyAppServlet_XXXX_XXXX_XXXX_XXXX)",
                   "login;url-pattern=/login;filter:=(service.pid=LoginServlet_XXXX_XXXX_XXXX_XXXX)" ]</pre>
          <p>
            The example above shows a snippet from the configuration of <a
              href="https://github.com/everit-org/jetty-server-ecm">Everit Jetty ServletContext
              Component</a>. The component uses the <i>requirement id</i> as servlet name. In the
            example, two servlets are pulled. They will be accessible on the path that is defined
            with the <i>url-pattern</i> attribute of the claues.
          </p>

          <h4 id="#reference-cardinality">Reference cardinality</h4>
          <p>
            The main difference between <i>Everit Component Model</i> and <a
              href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative Services</a> is how
            they handle the cardinality of references.
          </p>
          <p>
            During the usage of <a href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative
              Services</a>, the programmer can define zero or one OSGi filters to pick up one or more
            OSGi services.
          </p>
          <p>
            In <i>Everit Component Model</i> the programmer can define zero or more <a
              href="#requirement-config-filter">OSGi filter</a> or <a
              href="#requirement-config-clause">clause</a>. The reference will have as many
            requirement, as many entries are defined in the configuration. One requirement must wire
            to exactly one capability.
          </p>
          <p>
            Just like <a href="#attribute-cardinality">attribute cardinality</a>, reference
            cardinality can be specified with <i>optional</i> and <i>multiple</i> properties.
          </p>
          <h4 id="requirement-service-reference">Service reference</h4>
          Like <a href="http://wiki.osgi.org/wiki/Declarative_Services">Declarative Services</a>, <i>Everit
            Component Model</i> supports OSGi Service references, too. A <i>service reference</i> can
          have a <a href="#setter-method">setter method</a> with two different types:
          <ul>
            <li><p>The type of the OSGi service that is required</p> <pre
                class="prettyprint lang-java">
public void setOtherService(OtherService otherService) {
  this.otherService = otherService;
}</pre></li>
            <li>An OSGi service type array if the reference cardinality is multiple</li>
            <li><p>
                A parameter with <i>ServiceHolder</i> type. This type can be used to retrieve
                additional information about the reference.
              </p> <pre class="prettyprint lang-java">
public void setOtherService(ServiceHolder&lt;OtherService&gt; holder) {
  // Get the reference id
  String referenceId = holder.getReferenceId();

  // Get the OSGi service reference to analyze its service properties
  ServiceReference&lt;OtherService&gt; serviceReference = holder.getReference();

  // Get the instance to call its functions or assign it to a member variable
  OtherService serviceInstance = holder.getService();

  // Get the attributes defined in the clause of the requirement
  Map&lt;String, Object&gt; attributes = holder.getAttributes();
  
  ...
}</pre></li>
            <li>A <i>ServiceHolder&lt;ServiceType&gt;</i> array if the reference cardinality is
              multiple
            </li>
          </ul>
          <h4 id="requirement-bundle-capability">Bundle-Capability reference</h4>
          <p>
            <i>ECM components</i> can not only wire to OSGi services but also to <a
              href="http://wiki.osgi.org/wiki/Provide-Capability">Bundle capabilities</a>. A
            Bundle-Capability reference requirement becomes satisfied if there is a Bundle with a
            capability in the OSGi container that is in the necessary state, the attributes of the
            capability match the the filter of the requirement and the namespace of the capability
            matches the namespace of the reference.
          </p>
          <p>The setter of a Bundle-Capability reference can accept one of the following types
            as a parameter:</p>
          <ul>
            <li><a
              href="https://osgi.org/javadoc/r4v43/core/org/osgi/framework/wiring/BundleCapability.html">BundleCapability</a></li>
            <li><a
              href="https://osgi.org/javadoc/r4v43/core/org/osgi/framework/wiring/BundleCapability.html">BundleCapability</a>
              array if the cardinality of the reference is multiple</li>
            <li><i>BundleCapabilityHolder</i>, that can be used to retrieve the attributes of
              the requirement clause and the id of the requirement</li>
            <li><i>BundleCapabilityHolder</i> array if the cardinality of the reference is
              multiple</li>
          </ul>
          <h3>Component capabilities</h3>
          <h4>Service capability</h4>
          <p>
            An ECM component can have zero or more capabilities. At the moment, only one type of
            Capability is supported: <i>OSGi service</i>.
          </p>
          <p>
            <i>Component instance</i> can be registered as an OSGi service automatically. <i>ComponentMetadata</i>
            has a property called <i>service</i>. When this property is defined, the <a
              href="#component-context">component context</a> will register the <i>component
              instance</i> as an OSGi service in the end of the <a href="#state-starting">starting
              process</a>. Depending on the configuration of the service property, the OSGi service will
            be registered with the following interfaces:
          </p>
          <ul>
            <li>if no interface is specified, the OSGi service will be registered with all of
              the interfaces that the component instance implements</li>
            <li>otherwise those interfaces and class types will be used that are specified
              within the property</li>
          </ul>
          <p>
            The programmer can specify the <i>service</i> property via the <i>@Service</i>
            annotation, too.
          </p>
          <p>
            It is also possible to register OSGi services programmatically in the <a
              href="#activate-method">activate method</a> of the component instance. Programmers
            should always use the <a href="#component-context">ComponentContext</a> instance to
            register OSGi services instead of the <i>BundleContext</i>. <a href="#component-context">Component
              context</a> has the same methods for registering OSGi services as <i>BundleContext</i>
            has.
          </p>
          <p>
            When a service is registered via the <a href="#component-context">component context</a>
            it will appear as the capability of the component. Programmers can query this
            information programmatically, or see it on the <a href="#webconsole-plugin">ECM
              Webconsole Plugin</a> that helps them understanding the architecture of the software.
          </p>
          <p>
            One of the goals of ECM is to speed up failure detection. When a component is <a
              href="#state-unsatisfied">UNSATISFIED</a>, the <a href="#webconsole-plugin"></a> can
            show tips, which components could satisfy their <a href="#component-requirement">requirements</a>.
          </p>

          <h3 id="component-methods">Component methods</h3>
          <h4 id="setter-method">Setters</h4>
          <p>
            Every <a href="#component-attribute">attribute</a> and every <a
              href="#component-reference">reference</a> can have <i>setter</i> method. If an <a
              href="#component-attribute">attribute</a> or a <a href="#component-reference">reference</a>
            has <i>multiple</i> cardinality, the setter parameter must be an array.
          <h4 id="activate-method">Activate method</h4>
          <p>
            The activate method of the component instance is called by the <a
              href="#component-context">component context</a> during the <a href="#state-starting">starting
              process</a> of the component. The activate method can have the following type of
            arguments:
          </p>
          <ul>
            <li><a href="#">ComponentContext</a> that can be used to retrieve all information
              about the component: configuration, metadata, state, ...</li>
            <li><a
              href="https://osgi.org/javadoc/r4v43/core/org/osgi/framework/BundleContext.html">BundleContext</a></li>
          </ul>
          <p>
            If the <a href="#component-metadata">component metadata</a> does not define the
            arguments of the activate method, it will be searched with the following priority:
          </p>
          <ol>
            <li>a method with a ComponentContext parameter</li>
            <li>a method with a BundleContext parameter</li>
            <li>a method with a Map parameter</li>
            <li>a method that contains one or more of the following parameters:
              ComponentContext, BundleContext, Map</li>
            <li>a method without any parameter</li>
          </ol>

          <h4 id="update-method">Update method</h4>
          <p>
            The <a href="#component-context">component context</a> calls the <i>update method</i> of
            the component instance in the end of the <a href="#state-dynamic-update">dynamic
              update</a> process. The method does not take any parameters.
          </p>
          <h4 id="deactivate-method">Deactivate method</h4>
          <p>
            The <a href="#component-context">component context</a> calls the <i>deactivate
              method</i> during <a href="#state-stopping">stopping</a> the component. The method takes
            no parameters.
          </p>
          <h3>Metatype support</h3>
          <p>
            Every <a href="#component-container">component container</a> registers itself as an OSGi
            service with the <a
              href="https://osgi.org/javadoc/r4v43/cmpn/org/osgi/service/metatype/MetaTypeProvider.html">MetatypeProvider</a>
            interface if the <i>metatype</i> property of the <a href="#component-metadata">compoenent
              metadata</a> is set to <i>true</i>. It is also possible to set the metatype support for
            each <a href="#component-attribute">attribute</a> and <a href="#component-reference">reference</a>
            separately.
          </p>
          <p>The component, the attributes and the references can have label and description.
            When the label or description begins with "%" character, it behaves as a key that should
            be looked up in the file that belongs to the component.</p>
        </div>
      </div>
      <div class="bs-docs-featurette ecm-chapter" id="modules">
        <h2 class="bs-docs-featurette-title ">OSGi Bundles</h2>
        <p>
          ECM is built up from several bundles. Each bundle has its purpose. The separation is
          necessary to keep the technology stable and to be able to fix bugs in short development
          iterations. All bundles are available on <a
            href="http://search.maven.org/#search%7Cga%7C1%7Corg.everit.osgi.ecm">maven-central</a>.
        </p>
        <p class="text-center">
          <img src="ecm-dependency-graph.svg" style="max-width: 100%;" />
        </p>
        <h3 id="ecm-extender-api">ECM Extender API</h3>
        <p>Hello extender api</p>
      </div>
      <div class="bs-docs-featurette ecm-chapter" id="webconsole-plugin">
        <h2 class="bs-docs-featurette-title ">Webconsole plugin</h2>

      </div>
    </div>
    <div class="col-md-2">
      <nav id="affix-nav">
        <ul class="nav nav-pills nav-stacked everit-affix affix-top" data-spy="affix"
          data-offset-top="350" data-offset-bottom="140">
          <li class=""><a href="#introduction">Introduction</a></li>
          <li class=""><a href="#quickstart">Quick start</a>
            <ul class="nav nav-pills nav-stacked">
              <li class=""><a href="#usage-extender">Using the extender</a></li>
              <li class=""><a href="#usage-programmatic">Programmatic way</a></li>
            </ul></li>
          <li class=""><a href="#specification">Specification</a>
            <ul class="nav nav-pills nav-stacked">
              <li class=""><a href="#component-metadata">Component metadata</a></li>
              <li class=""><a href="#component-container">Component container</a></li>
              <li class=""><a href="#component-context">Component context</a></li>
              <li class=""><a href="#component-lifecycle">Component lifecycle</a></li>
            </ul></li>
          <li class=""><a href="#reference-handling">Reference handling</a></li>
          <li class=""><a href="#osgi-bundles">OSGi Bundles</a></li>
        </ul>
      </nav>
    </div>
  </div>


  <!-- Footer
================================================== -->
  <div></div>
  <footer class="bs-docs-footer" role="contentinfo">
    <div class="container">
      <div class="bs-docs-social">
        <ul class="bs-docs-social-buttons">
          <li class="follow-btn"><a href="https://twitter.com/EveritOrg"
            class="twitter-follow-button" data-show-count="true">Follow @EveritOrg</a></li>
          <li class="tweet-btn"><a href="https://twitter.com/share"
            class="twitter-share-button" data-url="http://www.everit.org/">Tweet</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Bootstrap core JavaScript
================================================== -->
  <!-- Placed at the end of the document so the pages load faster -->
  <script src="../js/jquery-2.1.1.min.js"></script>
  <script src="../js/bootstrap.min.js"></script>
  <script src="../js/everit.js"></script>
  <script type="text/javascript">
      (function() {
        var ga = document.createElement('script');
        ga.type = 'text/javascript';
        ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl'
            : 'http://www')
            + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0];
        s.parentNode.insertBefore(ga, s);
      })();
    </script>
  <script src="../js/prettify/run_prettify.js"></script>
</body>

</html>
